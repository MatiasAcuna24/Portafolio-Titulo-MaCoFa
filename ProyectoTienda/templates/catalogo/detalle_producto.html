{% extends "core/base.html" %}
{% load static %}

{% block title %}{{ producto.nombre }} | Dulce Arte{% endblock %}

{% block css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
<link rel="stylesheet" href="{% static 'core/css/detalle_producto.css' %}">
{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="product-section">
    <div class="row align-items-center">

      <!-- IMAGEN -->
      <div class="col-md-6 product-image text-center mb-4 mb-md-0">
        <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" class="img-fluid shadow">
      </div>

      <!-- INFORMACIÓN -->
      <div class="col-md-6">
        <h2 class="product-name">{{ producto.nombre }}</h2>
        <p class="product-category">{{ producto.categoria.nombre }}</p>

        <!-- PRECIO -->
        <p class="product-price mb-2">
          {% if producto.precio_con_descuento < producto.precio %}
            <del>${{ producto.precio|floatformat:0 }}</del>
            <span class="discount">${{ producto.precio_con_descuento|floatformat:0 }}</span>
          {% else %}
            <span>${{ producto.precio|floatformat:0 }}</span>
          {% endif %}
        </p>

        <!-- PROMOCIÓN -->
        {% if promo %}
          <p class="promo-info">
            <i class="bi bi-stars"></i>
            {% if promo.tipo == 'percent' %}
              {{ promo.valor|floatformat:0 }}% de descuento
            {% else %}
              ${{ promo.valor|floatformat:0 }} CLP de descuento
            {% endif %}
            {% if promo.fecha_fin %}
              — válido hasta {{ promo.fecha_fin|date:"d/m/Y" }}
            {% endif %}
          </p>
        {% endif %}

        <!-- DESCRIPCIÓN -->
        <p class="product-description mb-4">{{ producto.descripcion }}</p>

        <!-- CANTIDAD Y CARRITO -->
        {% if producto.stock > 0 %}
          <form action="{% url 'agregar_al_carrito' producto.id %}" method="post" class="mt-2">
            {% csrf_token %}
            <div class="input-group" style="max-width:250px;">
              <input type="number" name="cantidad" value="1" min="1" max="{{ producto.stock }}" class="form-control">
              <button type="submit" class="btn btn-add">
                <i class="bi bi-cart-plus"></i> Agregar
              </button>
            </div>
            <p class="mt-2 mb-0"><span class="badge-stock">En stock</span></p>
          </form>
        {% else %}
          <p><span class="badge-nostock">Sin stock</span></p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- VOLVER -->
  <div class="text-center mt-5">
    <a href="{% url 'productos' %}" class="btn btn-back">
      <i class="bi bi-arrow-left"></i> Volver al catálogo
    </a>
  </div>
</div>
{% endblock %}
