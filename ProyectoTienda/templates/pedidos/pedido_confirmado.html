{% extends "core/base.html" %}
{% load static %}
{% block title %}Pedido Confirmado | Dulce Arte{% endblock %}
{% block css %}
<link rel="stylesheet" href="{% static 'core/css/checkout.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
{% endblock %}
{% block content %}
<section class="checkout-wrap py-5"><div class="container checkout-surface"><div class="row g-4">
<div class="col-lg-6 col-md-12"><div class="text-center mb-5"><i class="bi bi-check-circle-fill text-success" style="font-size: 5rem;"></i><h1 class="mt-3">¬°Pedido confirmado con √©xito!</h1><p class="lead">Gracias por tu compra üßÅ Tu pedido fue registrado correctamente.</p></div>
<div class="card shadow-sm mb-4"><div class="card-body"><h2 class="card-title mb-4">Detalles del Pedido</h2>
<ul class="list-unstyled mb-4">
<li><strong>N√∫mero:</strong> {{ pedido.numero }}</li>
<li><strong>Estado:</strong> {{ pedido.estado|title }}</li>
<li><strong>Fecha:</strong> {{ pedido.creado_en|date:"d/m/Y H:i" }}</li>
{% if pedido.zona %}<li><strong>Zona de despacho:</strong> {{ pedido.zona.nombre }} ‚Äì {{ pedido.zona.tiempo_estimado_horas }}h</li>{% endif %}
<li><strong>Direcci√≥n de env√≠o:</strong> {{ pedido.direccion_envio }}</li>
{% if pedido.cupon %}<li><strong>Cup√≥n aplicado:</strong> {{ pedido.cupon.codigo }}</li>{% endif %}
</ul><hr>
<h3 class="mt-4">üßÅ Productos</h3>
<ul class="list-group mb-0">{% for item in pedido.items.all %}
<li class="list-group-item d-flex justify-content-between align-items-center">
<span>{{ item.producto.nombre }} (x{{ item.cantidad }})</span>
<strong>CLP {{ item.precio_unitario|floatformat:0 }}</strong>
</li>{% endfor %}
</ul></div></div></div>

<div class="col-lg-7 col-md-12"><div class="card shadow-sm sticky-top" style="top: 90px;">
<div class="card-body"><h3 class="mb-4 text-center">üì¶ Resumen del Pedido</h3>
<ul class="list-group mb-3">{% for item in pedido.items.all %}
<li class="list-group-item d-flex justify-content-between align-items-center">
<span>{{ item.producto.nombre }} (x{{ item.cantidad }})</span>
<span class="fw-semibold">CLP {{ item.precio_unitario|floatformat:0 }}</span>
</li>{% endfor %}
</ul><hr>

<div class="mb-2 d-flex justify-content-between"><span>Subtotal:</span>
<strong>CLP {{ pedido.subtotal|floatformat:0 }}</strong></div>

{% if pedido.descuento > 0 %}
<div class="mb-2 d-flex justify-content-between">
<span class="text-danger">Descuento total:</span>
<strong class="text-danger">-CLP {{ pedido.descuento|floatformat:0 }}</strong>
</div>{% endif %}

{% if pedido.cupon %}
<div class="mb-2 d-flex justify-content-between">
<span class="text-primary">Cup√≥n aplicado ({{ pedido.cupon.codigo }}):</span>
<strong class="text-primary">Incluido en descuento</strong>
</div>{% endif %}

{% if pedido.costo_despacho %}
<div class="mb-2 d-flex justify-content-between">
<span>Despacho ({{ pedido.zona.nombre }}):</span>
<strong>CLP {{ pedido.costo_despacho|floatformat:0 }}</strong>
</div>{% endif %}

<hr>
<div class="fs-4 fw-bold d-flex justify-content-between">
<span>Total:</span><span>CLP {{ pedido.total|floatformat:0 }}</span>
</div>

<div class="mt-4 d-grid gap-3">
<a href="{% url 'productos' %}" class="btn btn-cta btn-lg w-100"><i class="bi bi-bag-plus"></i> Seguir comprando</a>
<a href="{% url 'ver_pedidos' %}" class="btn btn-outline-secondary btn-lg w-100"><i class="bi bi-list-ul"></i> Ver todos mis pedidos</a>
</div>

</div></div></div>

</div></div></section>
{% endblock %}