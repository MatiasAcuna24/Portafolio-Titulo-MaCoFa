{% extends "core/base.html" %}
{% load static %}

{% block title %}Mis Pedidos | Dulce Arte{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'core/css/checkout.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
<style>
  .export-buttons {
    display: flex;
    justify-content: flex-end;
    gap: .75rem;
    flex-wrap: wrap;
    margin-bottom: 1.5rem;
  }
  .export-buttons a {
    display: inline-flex;
    align-items: center;
    gap: .4rem;
    font-weight: 600;
  }
  .export-buttons i {
    font-size: 1.1rem;
  }
  .table thead th {
    background-color: #a4d04f !important;
    color: #fff;
    border: none;
  }
  .badge {
    font-size: 0.85rem;
    padding: .5em .75em;
  }
  .checkout-title {
    font-weight: 700;
    color: #4b2c20;
  }
</style>
{% endblock %}

{% block content %}
<section class="checkout-wrap py-5">
  <div class="container checkout-surface">
    <!-- üßÅ T√≠tulo -->
    <h1 class="checkout-title text-center mb-4">üì¶ Mis Pedidos</h1>
    {% if pedidos %}
      <div class="table-responsive shadow-sm rounded-4">
        <table class="table table-hover align-middle text-center mb-0">
          <thead>
            <tr>
              <th># Pedido</th>
              <th>Estado</th>
              <th>Fecha</th>
              <th>Total</th>
              <th>Zona</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for pedido in pedidos %}
            <tr>
              <td><strong>{{ pedido.numero }}</strong></td>
              <td>
                <span class="badge 
                  {% if pedido.estado == 'pendiente' %}bg-warning text-dark
                  {% elif pedido.estado == 'enviado' %}bg-primary
                  {% elif pedido.estado == 'entregado' %}bg-success
                  {% elif pedido.estado == 'cancelado' %}bg-danger
                  {% else %}bg-secondary{% endif %}">
                  {{ pedido.estado|title }}
                </span>
              </td>
              <td>{{ pedido.fecha_creacion|date:"d/m/Y H:i" }}</td>
              <td>CLP {{ pedido.total|floatformat:0 }}</td>
              <td>{{ pedido.zona.nombre|default:"-" }}</td>
              <td class="d-flex justify-content-center gap-2 flex-wrap">

                <!-- üëÅÔ∏è Ver detalle -->
                <a href="{% url 'pedido_confirmado' pedido.id %}" class="btn btn-sm btn-outline-primary">
                  <i class="bi bi-eye"></i> Ver Detalle
                </a>

                <!-- ‚úèÔ∏è Actualizar estado (solo admin) -->
                {% if request.user.is_staff %}
                <a href="{% url 'actualizar_estado_pedido' pedido.id %}" class="btn btn-sm btn-warning">
                  <i class="bi bi-pencil-square"></i> Actualizar
                </a>

                <!-- üóëÔ∏è Eliminar pedido (solo admin) -->
                <form action="{% url 'eliminar_pedido' pedido.id %}" method="post" onsubmit="return confirm('¬øEst√°s seguro de eliminar este pedido?');">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-sm btn-danger">
                    <i class="bi bi-trash"></i> Eliminar
                  </button>
                </form>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="text-center py-5">
        <i class="bi bi-box-seam display-1 text-muted"></i>
        <p class="fs-4 mt-3">A√∫n no tienes pedidos registrados üç∞</p>
        <a href="{% url 'productos' %}" class="btn btn-cta btn-lg mt-3">
          <i class="bi bi-shop"></i> Ir al cat√°logo
        </a>
      </div>
    {% endif %}
  </div>
</section>
{% endblock %}
